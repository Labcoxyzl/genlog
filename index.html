<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy Inputs to Clipboard</title>
    <style>
        .title {
            font-weight: bold;
            text-decoration: underline;
        }

        .subtitle {
            font-weight: bold;
            text-decoration: wavy;
            color: cadetblue;
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
        function submitForm() {
            if (!$('#dataForm')[0].checkValidity()) {
                $('#dataForm')[0].reportValidity() //Show HTML5 Built-In Validation
                return false;
            }
            var formdata = copyToClipboard();
            fetch("https://script.google.com/macros/s/AKfycbxWDIX-eqA604ZwfPj7WbU0-5I4lAb1z088Jx2sbYPul-j6sb_XbW1pm2pgOzH9ix-J/exec", {
                redirect: "follow",
                method: "POST",
                body: JSON.stringify(formdata)
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error('Form submission failed!');
                    }
                })
                .then(data => {
                    alert('Form submitted successfully!');
                    console.log('Response:', data); // Log response
                    document.getElementById('dataForm').reset();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again later.');
                });
        }

        function copyToClipboard() {
            // Get input field values
            var date = new Date(document.getElementById("date").value).toLocaleDateString('en-sg', { day: "numeric", month: "long", year: "numeric" });
            var vehicleNumber = document.getElementById("vehicleNumber").value;
            var fe1Expiry = new Date(document.getElementById("fe1Expiry").value).toLocaleDateString('en-sg', { month: "long", year: "numeric" });
            var fe2Expiry = new Date(document.getElementById("fe2Expiry").value).toLocaleDateString('en-sg', { month: "long", year: "numeric" });
            var startTime = document.getElementById("startTime").value;
            var startEngineHour = document.getElementById("startEngineHour").value;
            var endTime = document.getElementById("endTime").value;
            var endEngineHour = document.getElementById("endEngineHour").value;
            var polLevel = document.getElementById("polLevel").value;
            var batteryVoltage = document.getElementById("batteryVoltage").value;
            var remarks = document.getElementById("remarks").value;
            var vehicleVariant = document.getElementById("vehicleVariant").value;

            var EngineHourDiff = parseFloat(endEngineHour - startEngineHour).toFixed(1)   //round to 1dp (optional)
            var startDT = new Date("1/1/1999 " + startTime);                            //arbitrary date to use date difference
            var endDT = new Date("1/1/1999 " + endTime);                                //returns unix time
            var GenTimeDiff = ((endDT.getTime() - startDT.getTime()) / 60000).toFixed(1)  //divide by 60*1000 to get minutes

            // Check if end time is ahead of start time
            var startDateTime = new Date(date + " " + startTime);
            var endDateTime = new Date(date + " " + endTime);
            if (endDateTime < startDateTime) {
                alert("End Time must be ahead of Start Time.");
                return false;
            }

            // Check if end engine hour is more than start engine hour
            if (parseFloat(endEngineHour) <= parseFloat(startEngineHour)) {
                alert("End Engine Hour must be more than Start Engine Hour.");
                return false;
            }

            if (remarks === "") { remarks = "NIL" }

            // Concatenate values
            var copiedText = "Date: " + date + "\n" +
                "Vehicle Number: " + vehicleNumber + " MID\n" +
                "Vehicle Variant: " + vehicleVariant + "\n" +
                "FE1 Expiry: " + fe1Expiry + "\n" +
                "FE2 Expiry: " + fe2Expiry + "\n" +
                "Start Time: " + startTime + "\n" +
                "Start Engine Hour: " + startEngineHour + "\n" +
                "End Time: " + endTime + "\n" +
                "End Engine Hour: " + endEngineHour + "\n" +
                "Gen. Run Results: " + `${EngineHourDiff} Engine Hours in ${GenTimeDiff} Minutes.\n` +
                "POL Level: " + polLevel + " Bar(s)\n" +
                "Battery Voltage: " + batteryVoltage + " Volts\n\n" +
                "Remarks / faults (if any): \n--------------------------\n" + remarks;

            // Copy to clipboard
            navigator.clipboard.writeText(copiedText).then(function () {
                alert("Copied to clipboard!");
            }, function () {
                alert("Failed to copy to clipboard!");
            });
            return {
                date: date,
                vehicleNumber: vehicleNumber,
                vehicleVariant: vehicleVariant,
                fe1Expiry: fe1Expiry,
                fe2Expiry: fe2Expiry,
                startTime: startTime,
                startEngineHour: startEngineHour,
                endTime: endTime,
                endEngineHour: endEngineHour,
                EngineHourDiff: EngineHourDiff,
                GenTimeDiff: GenTimeDiff,
                polLevel: polLevel,
                batteryVoltage: batteryVoltage,
                remarks: remarks
            }
        }

        function updateRangeOutput(rangeId, outputId) {
            document.getElementById(outputId).value = document.getElementById(rangeId).value;
        }


        function devFill() {
            document.getElementById('date').value = '2024-03-22'
            document.getElementById('vehicleNumber').value = "12345"
            document.getElementById('vehicleVariant').value = "DSM's Car"
            document.getElementById('fe1Expiry').value = "2025-10"
            document.getElementById('fe2Expiry').value = "2025-10"
            document.getElementById('startTime').value = "12:30"
            document.getElementById('startEngineHour').value = "1234"
            document.getElementById('endTime').value = "13:30"
            document.getElementById('endEngineHour').value = "1235"
            document.getElementById('polLevel').value = "6"
            document.getElementById('batteryVoltage').value = "27"
            document.getElementById('remarks').value = "aksdjl"
        }
    </script>
</head>

<body>
    <button onclick="devFill()">dev Button</button>
    <!-- Title -->
    <div class="title" style="font-size: 20px;">Welcome to 6AMB Vehicle E-Logbook!</style>
    </div>
    <div class="subtitle" style="font-size: 15px;">Enter your vehicle details below and copy to clipboard</div>
    <div class="subtitle" style="font-size: 15px;">Refresh page to reset inputs</div><br>
    <br>

    <!-- Form -->
    <form id="dataForm" onsubmit="return copyToClipboard()">
        <!-- Input fields -->
        <label for="date">Date of Check:</label><br>
        <input type="date" id="date" name="date" required style="width: 80%;"><br><br>

        <label for="vehicleNumber">Vehicle Number:</label><br>
        <input type="number" id="vehicleNumber" name="vehicleNumber" required step="1" min="10000" max="99999"
            style="width: 80%;" oninvalid="this.setCustomValidity('Vehicle Number must be 5 digits long.')"
            oninput="this.setCustomValidity('')"><br><br>

        <label for="vehicleVariant">Vehicle Variant:</label><br>
        <select id="vehicleVariant" required style="width: 80%;">
            <option value="CPAG-Warberg">CPAG-Warberg</option>
            <option value="CPAG-Hierra">CPAG-Hierra</option>
            <option value="10 Ton MTV">10 Ton MTV</option>
            <option value="DSM's Car">DSM's Car</option>
        </select><br><br>

        <label for="fe1Expiry">FE1 Expiry Month / Year:</label><br>
        <input type="month" id="fe1Expiry" name="fe1Expiry" required style="width: 80%;"><br><br>

        <label for="fe2Expiry">FE2 Expiry Month / Year:</label><br>
        <input type="month" id="fe2Expiry" name="fe2Expiry" required style="width: 80%;"><br><br>

        <label for="startTime">Start Time:</label><br>
        <input type="time" id="startTime" name="startTime" required style="width: 80%;"><br><br>

        <label for="startEngineHour">Start Engine Hour:</label><br>
        <input type="number" id="startEngineHour" name="startEngineHour" step="0.1" min="0" max="10000" required
            style="width: 80%;"><br><br>

        <label for="endTime">End Time:</label><br>
        <input type="time" id="endTime" name="endTime" required style="width: 80%;"><br><br>

        <label for="endEngineHour">End Engine Hour:</label><br>
        <input type="number" id="endEngineHour" name="endEngineHour" step="0.1" min="0" max="10000" required
            style="width: 80%;"><br><br>

        <label for="polLevel">POL Level:</label><br>
        <input type="range" id="polLevel" name="polLevel" min="0" max="6" value="0"
            onchange="updateRangeOutput('polLevel', 'polLevelOutput')" required style="width: 80%;">
        <output id="polLevelOutput">0</output> Bar(s)<br><br>

        <label for="batteryVoltage">Battery Voltage:</label><br>
        <input type="range" id="batteryVoltage" name="batteryVoltage" min="0" max="30" value="0"
            onchange="updateRangeOutput('batteryVoltage', 'batteryVoltageOutput')" required style="width: 80%;">
        <output id="batteryVoltageOutput">0</output> Volts<br><br>

        <label for="remarks">Remarks / Faults (if any):</label><br>
        <textarea id="remarks" name="remarks" rows="10" cols="50" style="width: 80%;"></textarea><br><br><br>

        <!-- Button to copy to clipboard -->
        <button type="submit" style="width: 100%; height: 30px; fill: chartreuse;">Copy ALL inputs to
            Clipboard</button><br><br>
        <button type="button" style="width: 100%; height: 30px; fill: chartreuse;"
            onclick="submitForm()">Submit</button>

        <div class="subtitle" style="font-size: 10px;">A project by 6TECH</div><br><br>
    </form>

</body>
<footer><br></footer>

</html>